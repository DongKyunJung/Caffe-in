# 📄 Caffe-in 배포 설정

### Frontend
React 17.0.2,  react-bootstrap 2.1.0, style-component 5.3.3, web-vitals 2.1.3

### Backend
IntelliJ, SpringBoot 2.5.6, Gradle 7.3.2

### DB / EC2
MySQL 8.0.28, Redis 5.0.7  
Ubuntu 20.04, Nginx 1.18.0, Jenkins 2.319.2  

## AWS EC2 필수 설치 항목
- Nginx 1.18.0
- openjdk version "11.0.13”
- MySQL 8.0.28
- Redis 5.0.7

## 💻 수동 배포
### 프론트 빌드 파일 위치 설정

/etc/nginx/sites-available/default

```
server {
        listen 80 default_server;
        listen [::]:80 default_server;

        root /home/ubuntu/build;

        # Add index.php to the list if you are using PHP
        index index.html index.htm index.nginx-debian.html;

        server_name _;

        location / {
                # First attempt to serve request as file, then
                # as directory, then fall back to displaying a 404.
                #try_files $uri $uri/ =404;
                try_files $uri $uri/ /index.html;
        }
}
```

### 백엔드 jar 실행

```bash
$ java -jar caffe_in.jar
# nohup java -jar caffe_in.jar &
```

## ⚙ Jenkins CI/CD 자동 배포
### npm & Jenkins 설치

```bash
$ curl -sL https://deb.nodesource.com/setup_14.x | sudo -E bash --
$ sudo apt-get install -y nodejs

$ node -v # v14.19.0
$ npm -v # 6.14.16
```

```bash
$ wget -q -O - https://pkg.jenkins.io/debian-stable/jenkins.io.key | sudo apt-key add -
$ sudo sh -c 'echo deb https://pkg.jenkins.io/debian-stable binary/ > \
    /etc/apt/sources.list.d/jenkins.list'
$ sudo apt-get update
$ sudo apt-get install jenkins

# systemctl status jenkins 또는 service jenkins status로 상태 확인
```

### Jenkins 포트 변경 (8080→8090)

/ect/init.d/jenkins

![image](https://user-images.githubusercontent.com/50658153/154447924-d22019ff-d808-4605-9bee-2ec731f796b9.png)

/etc/default/jenkins

![image](https://user-images.githubusercontent.com/50658153/154448000-dfdfa3e9-4b5b-48e5-8530-31ad5198f1a4.png)

```bash
$ service jenkins restart
# systemctl restart jenkins
```

### Jenkins 설정

[참고 링크](https://velog.io/@kido/EC2Jenkins-CICD-%EC%9E%90%EB%8F%99%EB%B0%B0%ED%8F%AC)

### 프론트 빌드 파일 위치 변경

/etc/nginx/sites-available/default

```
# react build 폴더로 root 경로 변경
root /var/lib/jenkins/workspace/caffe_in/frontend/build;
```

### Jenkins Build Execute Shell
![image](https://user-images.githubusercontent.com/50658153/154451501-adf7e817-8036-4ae0-8122-f25ff10ccf91.png)

## DB 접속 정보
